<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 æ±äº¬å…¨èƒ½æ‰‹å†Š</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        [v-cloak] { display: none; }
        body { font-family: -apple-system, "Noto Sans TC", sans-serif; background-color: #f8fafc; color: #1e293b; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-bottom { padding-bottom: calc(1.5rem + env(safe-area-inset-bottom)); }
        .tab-active { color: #2563eb; }
        .card-shadow { box-shadow: 0 4px 20px -5px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="pb-24">

<div id="app" v-cloak>
    <header class="p-4 bg-white border-b sticky top-0 z-50 flex justify-between items-center">
        <div>
            <h1 class="font-bold text-lg text-blue-900 leading-none">TOKYO 2026</h1>
            <p class="text-[10px] text-blue-500 font-black tracking-widest mt-1 uppercase">{{ page.toUpperCase() }}</p>
        </div>
        <div class="flex items-center space-x-2">
            <div class="text-right bg-slate-100 px-3 py-1 rounded-full">
                <span class="text-[10px] font-mono font-bold text-slate-500">ï¿¥1={{ exchangeRate }}</span>
            </div>
        </div>
    </header>

    <div v-if="page === 'trip'">
        <nav class="sticky top-[57px] z-40 bg-white/80 backdrop-blur-md border-b overflow-x-auto p-3 flex space-x-2 no-scrollbar">
            <button v-for="(day, index) in itinerary" :key="index" @click="currentDayIndex = index"
                :class="['px-4 py-2 rounded-2xl text-xs font-bold transition-all flex flex-col items-center min-w-[75px]', 
                        currentDayIndex === index ? 'bg-blue-600 text-white shadow-lg' : 'bg-gray-100 text-gray-400']">
                <span class="opacity-70 text-[10px]">Day {{ index + 1 }}</span>
                <span>{{ day.displayDate }}</span>
            </button>
        </nav>

        <main class="p-4 space-y-4">
            <section @click="navigate(itinerary[currentDayIndex].hotelAddr || itinerary[currentDayIndex].hotel)"
                class="bg-gradient-to-br from-indigo-600 to-blue-700 rounded-3xl p-5 text-white shadow-lg relative cursor-pointer">
                <div class="flex justify-between items-start mb-2">
                    <span class="text-[9px] bg-white/20 px-2 py-0.5 rounded font-black">LODGING</span>
                    <button @click.stop="openHotelModal" class="text-white/60"><i class="fas fa-edit"></i></button>
                </div>
                <h2 class="text-xl font-bold leading-tight">{{ itinerary[currentDayIndex].hotel }}</h2>
                <p class="text-[10px] opacity-70 mt-1 mb-4 h-4 overflow-hidden italic">{{ itinerary[currentDayIndex].hotelAddr }}</p>
                <div class="bg-white/10 py-3 rounded-2xl flex items-center justify-center border border-white/20 text-xs font-bold">
                    <i class="fas fa-location-arrow mr-2"></i>å¤§çœ¾é‹è¼¸å°èˆªå›é£¯åº—
                </div>
            </section>

            <div v-for="(spot, sIndex) in itinerary[currentDayIndex].spots" :key="spot.id">
                <div v-if="sIndex > 0" class="flex flex-col items-center my-1 opacity-20">
                    <span class="text-[9px] font-bold"><i class="fas fa-clock mr-1"></i>ç´„ 25-40åˆ†</span>
                </div>
                <div class="bg-white rounded-3xl p-5 card-shadow border border-gray-100">
                    <div class="flex justify-between items-start mb-1">
                        <span :class="['text-[9px] px-2 py-0.5 rounded font-black uppercase tracking-widest', typeClass(spot.type)]">{{ spot.type }}</span>
                        <button @click="removeSpot(sIndex)" class="text-gray-200">âœ•</button>
                    </div>
                    <h3 class="font-bold text-lg text-gray-800">{{ spot.name }}</h3>
                    <p class="text-sm text-gray-500 mt-1 mb-4 leading-relaxed">{{ spot.note }}</p>
                    <div class="flex gap-2">
                        <button @click="navigate(spot.name)" class="flex-1 bg-slate-900 text-white py-3 rounded-2xl text-sm font-bold shadow-md">
                            <i class="fas fa-train mr-1"></i> è½‰ä¹˜å°èˆª
                        </button>
                        <label class="w-12 bg-slate-100 flex items-center justify-center rounded-2xl cursor-pointer">
                            <i class="fas fa-camera text-slate-400"></i>
                            <input type="file" class="hidden" @change="uploadPhoto($event, sIndex)" accept="image/*">
                        </label>
                    </div>
                    <div v-if="spot.photo" class="mt-4 rounded-xl overflow-hidden"><img :src="spot.photo" class="w-full h-40 object-cover"></div>
                </div>
            </div>
            <button @click="isModalOpen = true" class="w-full py-4 border-2 border-dashed border-slate-200 rounded-2xl text-slate-400 font-bold text-sm">+ æ–°å¢è¡Œç¨‹é»</button>
        </main>
    </div>

    <div v-if="page === 'wallet'" class="p-4 space-y-4">
        <div class="bg-white rounded-3xl p-6 card-shadow border border-slate-100">
            <h2 class="text-slate-400 text-[10px] font-black uppercase tracking-widest">Total Balance å‰©é¤˜é ç®—</h2>
            <p :class="['text-3xl font-black mt-1', calculateBalance() < 0 ? 'text-red-500' : 'text-blue-600']">${{ formatNumber(calculateBalance()) }}</p>
            <div class="w-full bg-slate-100 h-2 rounded-full mt-4 overflow-hidden">
                <div class="bg-blue-500 h-full transition-all" :style="{width: (totalExpenses()/budget.total*100) + '%'}"></div>
            </div>
            <div class="mt-4 flex justify-between text-[11px] font-bold text-slate-400 uppercase">
                <span>Spent: ${{ formatNumber(totalExpenses()) }}</span>
                <span>Limit: ${{ formatNumber(budget.total) }}</span>
            </div>
        </div>

        <div class="bg-white rounded-3xl card-shadow overflow-hidden border border-slate-100">
            <div class="p-4 bg-slate-50 border-b flex justify-between items-center">
                <h3 class="font-bold text-sm">æ”¯å‡ºæ˜ç´°</h3>
                <button @click="openExpenseModal" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-bold">+ æ–°å¢</button>
            </div>
            <div class="divide-y divide-slate-50">
                <div v-for="(exp, index) in budget.expenses" :key="index" class="p-4 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-lg">
                            {{ categoryIcon(exp.category) }}
                        </div>
                        <div>
                            <p class="font-bold text-sm text-slate-800">{{ exp.item }}</p>
                            <p class="text-[10px] text-slate-400">{{ exp.note || 'ç„¡å‚™è¨»' }} Â· {{ exp.date }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-mono font-black text-red-500">-${{ formatNumber(exp.amount) }}</p>
                        <button @click="removeExpense(index)" class="text-[10px] text-slate-300">åˆªé™¤</button>
                    </div>
                </div>
                <div v-if="budget.expenses.length === 0" class="p-10 text-center text-slate-300 text-sm">é»æ“ŠæŒ‰éˆ•è¨˜éŒ„ç¬¬ä¸€ç­†æ¶ˆè²»</div>
            </div>
        </div>
    </div>

    <div v-if="page === 'info'" class="p-4 space-y-4">
        <div class="bg-blue-900 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
            <div class="relative z-10">
                <h2 class="text-xl font-bold mb-2">Visit Japan Web</h2>
                <p class="text-xs opacity-70 mb-5 leading-relaxed">å…¥å¢ƒå¯©æŸ¥ã€æµ·é—œç”³å ± QR Code é å‚™ã€‚</p>
                <a href="https://vjw-lp.digital.go.jp/zh-hant/" target="_blank" class="inline-block bg-white text-blue-900 px-6 py-3 rounded-2xl text-sm font-black shadow-lg">
                    <i class="fas fa-external-link-alt mr-2"></i>ç«‹åˆ»é–‹å•Ÿå®˜æ–¹ç¶²é 
                </a>
            </div>
            <i class="fas fa-passport absolute -right-4 -bottom-4 text-8xl opacity-10"></i>
        </div>

        <div class="bg-white rounded-3xl card-shadow border border-slate-100 overflow-hidden">
            <div class="p-4 bg-red-50 text-red-600 border-b flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <h3 class="font-black text-sm uppercase tracking-widest">ç·Šæ€¥æ‡‰è®Šè³‡è¨Š</h3>
            </div>
            <div class="p-4 space-y-4">
                <div class="border-b pb-3">
                    <p class="text-[10px] text-slate-400 font-bold uppercase">é§æ—¥ä»£è¡¨è™• (æ±äº¬)</p>
                    <p class="text-sm font-bold mt-1">é›»è©±ï¼š<a href="tel:0332807811" class="text-blue-600">03-3280-7811</a></p>
                    <p class="text-[10px] text-red-400 mt-1">â€» æ€¥é›£æ•‘åŠ©å°ˆç·šï¼š090-2657-5206</p>
                </div>
                <div class="border-b pb-3">
                    <p class="text-[10px] text-slate-400 font-bold uppercase">è­·ç…§éºå¤±è¾¦ç†</p>
                    <p class="text-sm leading-relaxed text-slate-600 mt-1">
                        1. å‘è­¦å¯Ÿå±€å ±æ¡ˆå–å¾—éºå¤±è­‰æ˜ã€‚<br>
                        2. è¯ç¹«ä»£è¡¨è™•ç”³è«‹è‡¨æ™‚å…¥åœ‹è­‰æ˜ã€‚
                    </p>
                </div>
                <div>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">é†«ç™‚æ•‘è­· (119)</p>
                    <p class="text-sm text-slate-600 mt-1">è‹¥éœ€é€šè­¯æœå‹™ï¼Œå¯æ’¥æ‰“ <span class="font-bold text-slate-900">03-5285-8181</span> (æ±äº¬éƒ½é†«ç™‚è«®è©¢)ã€‚</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-3xl card-shadow p-5 border border-slate-100">
            <h3 class="font-bold text-sm mb-4">æˆ‘çš„é‡è¦è³‡è¨Šå‚™å¿˜</h3>
            <textarea v-model="infoNotes" @input="saveData" placeholder="ä¾‹å¦‚ï¼šè­·ç…§è™Ÿç¢¼ã€ä¿éšªå–®è™Ÿã€å‚™ç”¨ä¿¡ç”¨å¡è™Ÿ..." 
                class="w-full h-32 bg-slate-50 rounded-2xl p-4 text-sm outline-none focus:ring-2 focus:ring-blue-100"></textarea>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t flex justify-around p-3 safe-bottom z-50">
        <button @click="page = 'trip'" :class="['flex flex-col items-center transition-colors', page === 'trip' ? 'text-blue-600' : 'text-slate-300']">
            <i class="fas fa-map-marked-alt text-xl"></i><span class="text-[9px] font-bold mt-1 uppercase">Trip</span>
        </button>
        <button @click="page = 'wallet'" :class="['flex flex-col items-center transition-colors', page === 'wallet' ? 'text-blue-600' : 'text-slate-300']">
            <i class="fas fa-wallet text-xl"></i><span class="text-[9px] font-bold mt-1 uppercase">Wallet</span>
        </button>
        <button @click="page = 'info'" :class="['flex flex-col items-center transition-colors', page === 'info' ? 'text-blue-600' : 'text-slate-300']">
            <i class="fas fa-info-circle text-xl"></i><span class="text-[9px] font-bold mt-1 uppercase">Info</span>
        </button>
    </nav>

    <div v-if="isExpenseModalOpen" class="fixed inset-0 bg-black/60 z-[100] flex items-end">
        <div class="bg-white w-full rounded-t-[32px] p-6 pb-12 shadow-2xl">
            <h2 class="text-xl font-bold mb-6 italic">Record Expense</h2>
            <div class="space-y-3">
                <input v-model="expenseForm.item" placeholder="å“é …åç¨±" class="w-full p-4 bg-slate-100 rounded-2xl outline-none">
                <div class="flex gap-2">
                    <input v-model.number="expenseForm.amount" type="number" placeholder="é‡‘é¡ (TWD)" class="flex-1 p-4 bg-slate-100 rounded-2xl outline-none">
                    <select v-model="expenseForm.category" class="w-1/3 p-4 bg-slate-100 rounded-2xl outline-none text-sm font-bold">
                        <option value="food">ä¼™é£Ÿ</option>
                        <option value="transport">äº¤é€š</option>
                        <option value="shop">è³¼ç‰©</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                <input v-model="expenseForm.note" placeholder="å‚™è¨» (é¸å¡«)" class="w-full p-4 bg-slate-100 rounded-2xl outline-none">
            </div>
            <button @click="addExpense" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold mt-6 shadow-lg shadow-blue-100">ç¢ºèªè¨˜éŒ„</button>
            <button @click="isExpenseModalOpen = false" class="w-full py-3 text-slate-400 mt-2">å–æ¶ˆ</button>
        </div>
    </div>

    <div v-if="isModalOpen" class="fixed inset-0 bg-black/60 z-[100] flex items-end">
        <div class="bg-white w-full rounded-t-[32px] p-6 pb-12">
            <h2 class="text-xl font-bold mb-4">æ–°å¢è¡Œç¨‹</h2>
            <input v-model="newSpot.name" placeholder="åœ°é»" class="w-full p-4 bg-slate-100 rounded-2xl mb-3 outline-none">
            <textarea v-model="newSpot.note" placeholder="å‚™è¨»..." class="w-full p-4 bg-slate-100 rounded-2xl mb-6 h-24 outline-none"></textarea>
            <button @click="addSpot" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold">ç¢ºèª</button>
            <button @click="isModalOpen = false" class="w-full py-3 text-slate-400 mt-2">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;
const STORAGE_KEY = 'tokyo_v7_master';

createApp({
    data() {
        return {
            page: 'trip',
            exchangeRate: '0.2115',
            currentDayIndex: 0,
            isModalOpen: false,
            isExpenseModalOpen: false,
            infoNotes: '',
            expenseForm: { item: '', amount: 0, category: 'food', note: '' },
            newSpot: { name: '', note: '', type: 'spot', photo: null },
            budget: { total: 49500, expenses: [] },
            itinerary: []
        }
    },
    methods: {
        formatNumber(n) { return Math.round(n || 0).toLocaleString(); },
        typeClass(t) {
            const c = { food: 'bg-red-50 text-red-500', spot: 'bg-indigo-50 text-blue-600', shop: 'bg-emerald-50 text-green-600' };
            return c[t] || 'bg-slate-50 text-slate-400';
        },
        categoryIcon(cat) {
            const icons = { food: 'ğŸ±', transport: 'ğŸšƒ', shop: 'ğŸ›ï¸', other: 'ğŸ·ï¸' };
            return icons[cat] || 'ğŸ’°';
        },
        navigate(q) { window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(q)}&travelmode=transit`, '_blank'); },
        openExpenseModal() { this.isExpenseModalOpen = true; },
        addExpense() {
            if(!this.expenseForm.item || !this.expenseForm.amount) return;
            this.budget.expenses.unshift({ ...this.expenseForm, date: new Date().toLocaleDateString() });
            this.saveData();
            this.expenseForm = { item: '', amount: 0, category: 'food', note: '' };
            this.isExpenseModalOpen = false;
        },
        totalExpenses() { return this.budget.expenses.reduce((s, e) => s + (e.amount || 0), 0); },
        calculateBalance() { return this.budget.total - this.totalExpenses(); },
        removeExpense(i) { this.budget.expenses.splice(i, 1); this.saveData(); },
        addSpot() {
            if(this.newSpot.name) {
                this.itinerary[this.currentDayIndex].spots.push({...this.newSpot, id: Date.now()});
                this.saveData();
                this.newSpot = { name: '', note: '', type: 'spot', photo: null };
                this.isModalOpen = false;
            }
        },
        uploadPhoto(e, i) {
            const file = e.target.files[0];
            if (file) {
                const r = new FileReader();
                r.onload = (ev) => { this.itinerary[this.currentDayIndex].spots[i].photo = ev.target.result; this.saveData(); };
                r.readAsDataURL(file);
            }
        },
        saveData() { 
            localStorage.setItem(STORAGE_KEY, JSON.stringify({ 
                itinerary: this.itinerary, 
                budget: this.budget,
                infoNotes: this.infoNotes
            })); 
        },
        init() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const d = JSON.parse(saved);
                this.itinerary = d.itinerary;
                this.budget = d.budget;
                this.infoNotes = d.infoNotes || '';
            } else {
                this.itinerary = [
                    { date: '2026-03-05', displayDate: '3/05 (å››)', hotel: 'æ¸…æ¾„ç™½æ²³ Comfort Hotel', hotelAddr: '1 Chome-6-12 Shirakawa, Koto City, Tokyo', spots: [{ id: 1, name: 'ç¾½ç”°æ©Ÿå ´ (HND)', type: 'spot', note: 'æŠµé” (TSA-HND)\n12:00 WBC å°æ¾³' }] },
                    { date: '2026-03-06', displayDate: '3/06 (äº”)', hotel: 'æ¸…æ¾„ç™½æ²³ Comfort Hotel', hotelAddr: '1 Chome-6-12 Shirakawa, Koto City, Tokyo', spots: [{ id: 2, name: 'è‚‰ã®ç”°ã˜ã¾', type: 'food', note: '19:00 WBC å°æ—¥' }] },
                    { date: '2026-03-07', displayDate: '3/07 (å…­)', hotel: 'æ¸…æ¾„ç™½æ²³ Comfort Hotel', hotelAddr: '1 Chome-6-12 Shirakawa, Koto City, Tokyo', spots: [{ id: 3, name: 'Artizon ç¾è¡“é¤¨', type: 'spot', note: 'éŠ€åº§ã€éº»å¸ƒå°ä¹‹ä¸˜' }] },
                    { date: '2026-03-08', displayDate: '3/08 (æ—¥)', hotel: 'æ¸…æ¾„ç™½æ²³ Comfort Hotel', hotelAddr: '1 Chome-6-12 Shirakawa, Koto City, Tokyo', spots: [{ id: 4, name: 'æ±äº¬å·¨è›‹', type: 'spot', note: '12:00 WBC å°éŸ“' }] },
                    { date: '2026-03-09', displayDate: '3/09 (ä¸€)', hotel: 'JRæ±æ—¥æœ¬é…’åº— Mets æ©«æ¿±', hotelAddr: 'ç¥å¥ˆå·ç¸£æ©«æ¿±å¸‚ç¥å¥ˆå·å€é¶´å±‹ç”º1-1-1', spots: [{ id: 5, name: 'æ©«æ¿±ç´…ç£šå€‰åº«', type: 'shop', note: 'Gundam Factory' }] },
                    { date: '2026-03-10', displayDate: '3/10 (äºŒ)', hotel: 'JRæ±æ—¥æœ¬é…’åº— Mets æ©«æ¿±', hotelAddr: 'ç¥å¥ˆå·ç¸£æ©«æ¿±å¸‚ç¥å¥ˆå·å€é¶´å±‹ç”º1-1-1', spots: [{ id: 6, name: 'éŒå€‰å¤§ä½›', type: 'spot', note: 'é•·è°·ç«™ã€æ±Ÿä¹‹å³¶' }] },
                    { date: '2026-03-11', displayDate: '3/11 (ä¸‰)', hotel: 'Home', hotelAddr: '', spots: [{ id: 7, name: 'ç¾½ç”°æ©Ÿå ´', type: 'spot', note: 'è¿”å®¶' }] }
                ];
                this.budget.expenses = [{ item: 'ANA æ©Ÿç¥¨', amount: 25186, category: 'transport', note: 'ä¾†å›æ©Ÿç¥¨', date: '2026/03/05' }];
            }
        }
    },
    created() {
        this.init();
        fetch('https://api.exchangerate-api.com/v4/latest/JPY').then(r => r.json()).then(d => this.exchangeRate = d.rates.TWD.toFixed(4)).catch(()=>{});
    }
}).mount('#app');
</script>
</body>
</html>
