<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 æ±äº¬æ—…éŠåŠ©æ‰‹ V5</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        [v-cloak] { display: none; }
        body { font-family: -apple-system, "Noto Sans TC", sans-serif; background-color: #f1f5f9; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-bottom { padding-bottom: calc(1rem + env(safe-area-inset-bottom)); }
        .tab-active { color: #2563eb; }
    </style>
</head>
<body>

<div id="app" v-cloak>
    <header class="p-4 bg-white border-b sticky top-0 z-50 flex justify-between items-center shadow-sm">
        <div>
            <h1 class="font-bold text-lg text-blue-900">TOKYO 2026</h1>
            <p class="text-[10px] text-blue-500 font-black tracking-widest">{{ page === 'main' ? 'ITINERARY' : 'BUDGET' }}</p>
        </div>
        <div class="text-right">
            <span class="text-[10px] text-gray-400 block italic">1 JPY â‰ˆ {{ exchangeRate }} TWD</span>
            <span class="text-sm font-bold text-green-600">é¤˜é¡: ${{ formatNumber(calculateBalance()) }}</span>
        </div>
    </header>

    <div v-if="page === 'main'">
        <nav class="sticky top-[61px] z-40 bg-white/90 backdrop-blur border-b overflow-x-auto p-3 flex space-x-2 no-scrollbar">
            <button v-for="(day, index) in itinerary" @click="currentDayIndex = index"
                :class="['px-5 py-2 rounded-xl text-sm font-bold transition', currentDayIndex === index ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-400']">
                D{{ index + 1 }}
            </button>
        </nav>

        <main class="p-4 space-y-4">
            <section class="bg-gradient-to-br from-blue-500 to-blue-700 rounded-3xl p-5 text-white shadow-lg relative">
                <div class="flex justify-between items-start mb-2">
                    <span class="text-[10px] bg-white/20 px-2 py-1 rounded font-bold">HOTEL</span>
                    <button @click.stop="openHotelModal" class="text-white/70 text-xs"><i class="fas fa-edit"></i> ç·¨è¼¯</button>
                </div>
                <div @click="navigate(itinerary[currentDayIndex].hotelAddr || itinerary[currentDayIndex].hotel)" class="cursor-pointer">
                    <h2 class="text-xl font-bold">{{ itinerary[currentDayIndex].hotel }}</h2>
                    <p class="text-[10px] opacity-70 mt-1 mb-4"><i class="fas fa-map-marker-alt"></i> {{ itinerary[currentDayIndex].hotelAddr || 'é»æ“Šç·¨è¼¯åœ°å€ä»¥ç²¾æº–å°èˆª' }}</p>
                    <div class="bg-white/10 p-3 rounded-2xl flex items-center justify-center border border-white/20">
                        <span class="text-sm font-bold"><i class="fas fa-subway mr-2"></i>é»æ“Šé–‹å•Ÿå¤§çœ¾é‹è¼¸å°èˆª</span>
                    </div>
                </div>
            </section>

            <div v-for="(spot, sIndex) in itinerary[currentDayIndex].spots" :key="spot.id">
                <div v-if="sIndex > 0" class="flex items-center justify-center my-2 space-x-2 opacity-50">
                    <div class="h-[20px] w-0.5 bg-dashed border-l border-gray-300"></div>
                    <span class="text-[10px] font-bold text-gray-400"><i class="fas fa-clock"></i> é ä¼°äº¤é€š {{ estimateTransit(itinerary[currentDayIndex].spots[sIndex-1].name, spot.name) }}</span>
                    <div class="h-[20px] w-0.5 bg-dashed border-l border-gray-300"></div>
                </div>

                <div class="bg-white rounded-3xl p-5 shadow-sm border border-gray-100 relative">
                    <div class="flex justify-between items-start mb-2">
                        <span :class="['text-[9px] px-2 py-0.5 rounded font-black uppercase tracking-widest', typeClass(spot.type)]">{{ spot.type }}</span>
                        <button @click="removeSpot(sIndex)" class="text-gray-200">âœ•</button>
                    </div>
                    <h3 class="font-bold text-lg text-gray-800">{{ spot.name }}</h3>
                    <p class="text-sm text-gray-500 mt-1 mb-4">{{ spot.note }}</p>
                    <div v-if="spot.photo" class="mb-4 rounded-2xl overflow-hidden shadow-sm"><img :src="spot.photo" class="w-full h-40 object-cover"></div>
                    <div class="flex gap-2">
                        <button @click="navigate(spot.name)" class="flex-1 bg-gray-900 text-white py-3.5 rounded-2xl text-sm font-bold">ğŸšƒ ä¹˜æ›å°èˆª</button>
                        <label class="w-14 bg-gray-100 flex items-center justify-center rounded-2xl cursor-pointer">ğŸ“·<input type="file" class="hidden" @change="uploadPhoto($event, sIndex)"></label>
                    </div>
                </div>
            </div>

            <button @click="isModalOpen = true" class="w-full py-5 border-2 border-dashed border-gray-300 rounded-3xl text-gray-400 font-bold">+ æ–°å¢åœ°é»</button>
        </main>
    </div>

    <div v-if="page === 'budget'" class="p-4 space-y-4">
        <div class="bg-white rounded-3xl p-6 shadow-sm">
            <h2 class="text-gray-400 text-xs font-bold uppercase mb-1">Total Budget ç¸½é ç®—</h2>
            <p class="text-3xl font-black text-blue-600">${{ formatNumber(budget.total) }}</p>
            <div class="mt-4 grid grid-cols-2 gap-4 border-t pt-4">
                <div><p class="text-[10px] text-gray-400">å·²èŠ±è²» (TWD)</p><p class="text-lg font-bold text-red-500">${{ formatNumber(totalExpenses()) }}</p></div>
                <div><p class="text-[10px] text-gray-400">å‰©é¤˜é ç®—</p><p class="text-lg font-bold text-green-600">${{ formatNumber(calculateBalance()) }}</p></div>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-sm overflow-hidden">
            <div class="p-4 bg-gray-50 border-b flex justify-between">
                <span class="font-bold">æ”¯å‡ºæ˜ç´°</span>
                <button @click="addExpense" class="text-blue-600 font-bold">+ æ–°å¢</button>
            </div>
            <div class="divide-y divide-gray-100">
                <div v-for="(exp, index) in budget.expenses" class="p-4 flex justify-between items-center">
                    <div><p class="font-bold text-sm">{{ exp.item }}</p><p class="text-[10px] text-gray-400">{{ exp.date }}</p></div>
                    <div class="text-right">
                        <p class="font-mono font-bold text-red-500">-${{ formatNumber(exp.amount) }}</p>
                        <button @click="removeExpense(index)" class="text-[10px] text-gray-300">åˆªé™¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t flex justify-around p-3 safe-bottom z-50">
        <button @click="page = 'main'" :class="['flex flex-col items-center', page === 'main' ? 'text-blue-600' : 'text-gray-300']">
            <i class="fas fa-calendar-alt text-xl"></i><span class="text-[10px] font-bold mt-1">è¡Œç¨‹</span>
        </button>
        <button @click="page = 'budget'" :class="['flex flex-col items-center', page === 'budget' ? 'text-blue-600' : 'text-gray-300']">
            <i class="fas fa-wallet text-xl"></i><span class="text-[10px] font-bold mt-1">è¨˜å¸³</span>
        </button>
    </nav>

    <div v-if="isHotelModalOpen" class="fixed inset-0 bg-black/60 z-[100] flex items-end">
        <div class="bg-white w-full rounded-t-[32px] p-6 pb-10 shadow-2xl">
            <h2 class="text-xl font-bold mb-4">ç·¨è¼¯é£¯åº—è³‡è¨Š</h2>
            <input v-model="hotelForm.name" placeholder="é£¯åº—åç¨±" class="w-full p-4 bg-gray-100 rounded-2xl mb-3 outline-none">
            <input v-model="hotelForm.addr" placeholder="å®Œæ•´åœ°å€ (ç”¨æ–¼ç²¾æº–å°èˆª)" class="w-full p-4 bg-gray-100 rounded-2xl mb-6 outline-none">
            <button @click="saveHotelInfo" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold">å„²å­˜</button>
            <button @click="isHotelModalOpen = false" class="w-full py-4 text-gray-400 text-sm mt-2">å–æ¶ˆ</button>
        </div>
    </div>

    <div v-if="isModalOpen" class="fixed inset-0 bg-black/60 z-[100] flex items-end">
        <div class="bg-white w-full rounded-t-[32px] p-6 pb-10 shadow-2xl">
            <h2 class="text-xl font-bold mb-4">æ–°å¢åœ°é»</h2>
            <input v-model="newSpot.name" placeholder="åœ°é»åç¨±" class="w-full p-4 bg-gray-100 rounded-2xl mb-3 outline-none">
            <textarea v-model="newSpot.note" placeholder="å‚™è¨»..." class="w-full p-4 bg-gray-100 rounded-2xl mb-6 h-20 outline-none"></textarea>
            <button @click="addSpot" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold">ç¢ºèªæ–°å¢</button>
            <button @click="isModalOpen = false" class="w-full py-4 text-gray-400 text-sm mt-2">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;
const STORAGE_KEY = 'tokyo_v5_final';

createApp({
    data() {
        return {
            page: 'main',
            exchangeRate: '0.2115',
            currentDayIndex: 0,
            isModalOpen: false,
            isHotelModalOpen: false,
            hotelForm: { name: '', addr: '' },
            newSpot: { name: '', note: '', type: 'spot', photo: null },
            budget: { total: 49500, expenses: [] },
            itinerary: []
        }
    },
    methods: {
        formatNumber(n) { return Math.round(n).toLocaleString(); },
        typeClass(t) {
            const c = { food: 'bg-red-50 text-red-500', spot: 'bg-blue-50 text-blue-500', shop: 'bg-green-50 text-green-500' };
            return c[t] || 'bg-gray-50 text-gray-400';
        },
        navigate(query) {
            window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(query)}&travelmode=transit`, '_blank');
        },
        openHotelModal() {
            const h = this.itinerary[this.currentDayIndex];
            this.hotelForm = { name: h.hotel, addr: h.hotelAddr || '' };
            this.isHotelModalOpen = true;
        },
        saveHotelInfo() {
            this.itinerary[this.currentDayIndex].hotel = this.hotelForm.name;
            this.itinerary[this.currentDayIndex].hotelAddr = this.hotelForm.addr;
            this.saveData();
            this.isHotelModalOpen = false;
        },
        addExpense() {
            const item = prompt('æ¶ˆè²»é …ç›®ï¼š');
            const amount = prompt('é‡‘é¡ (TWD)ï¼š');
            if(item && amount) {
                this.budget.expenses.unshift({ item, amount: parseFloat(amount), date: new Date().toLocaleDateString() });
                this.saveData();
            }
        },
        totalExpenses() { return this.budget.expenses.reduce((sum, e) => sum + e.amount, 0); },
        calculateBalance() { return this.budget.total - this.totalExpenses(); },
        removeExpense(i) { this.budget.expenses.splice(i, 1); this.saveData(); },
        estimateTransit(start, end) {
            // ç°¡æ˜“æ¨¡æ“¬é‚è¼¯ï¼šåŒåœ°å€ 15-20mï¼Œè·¨å€ 30-40m
            if (start.includes('æ©Ÿå ´') || end.includes('æ©Ÿå ´')) return '45-60 min';
            if (start.includes('æ¸…æ¾„ç™½æ²³') && end.includes('æ±äº¬å·¨è›‹')) return '25 min';
            return '20-30 min';
        },
        uploadPhoto(e, i) {
            const file = e.target.files[0];
            if (file) {
                const r = new FileReader();
                r.onload = (ev) => { this.itinerary[this.currentDayIndex].spots[i].photo = ev.target.result; this.saveData(); };
                r.readAsDataURL(file);
            }
        },
        addSpot() {
            if(this.newSpot.name) {
                this.itinerary[this.currentDayIndex].spots.push({...this.newSpot, id: Date.now()});
                this.saveData();
                this.newSpot = { name: '', note: '', type: 'spot', photo: null };
                this.isModalOpen = false;
            }
        },
        removeSpot(i) { this.itinerary[this.currentDayIndex].spots.splice(i, 1); this.saveData(); },
        saveData() { 
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                itinerary: this.itinerary,
                budget: this.budget
            })); 
        },
        init() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const d = JSON.parse(saved);
                this.itinerary = d.itinerary;
                this.budget = d.budget;
            } else {
                this.itinerary = [
                    { date: '3/05', hotel: 'æ¸…æ¾„ç™½æ²³ Comfort Hotel', hotelAddr: 'æ±äº¬éƒ½æ±Ÿæ±å€ç™½æ²³1-6-12', spots: [{ id: 1, name: 'ç¾½ç”°æ©Ÿå ´ (HND)', type: 'spot', note: 'æŠµé”' }, { id: 2, name: 'æ±äº¬å·¨è›‹', type: 'spot', note: 'WBC å°æ¾³ 12:00' }] },
                    { date: '3/06', hotel: 'æ¸…æ¾„ç™½æ²³ Comfort Hotel', hotelAddr: 'æ±äº¬éƒ½æ±Ÿæ±å€ç™½æ²³1-6-12', spots: [{ id: 3, name: 'è‚‰ã®ç”°ã˜ã¾', type: 'food', note: 'ç‡’è‚‰åˆé¤' }, { id: 4, name: 'æ±äº¬å·¨è›‹', type: 'spot', note: 'WBC å°æ—¥ 19:00' }] },
                    { date: '3/07', hotel: 'æ¸…æ¾„ç™½æ²³ Comfort Hotel', hotelAddr: 'æ±äº¬éƒ½æ±Ÿæ±å€ç™½æ²³1-6-12', spots: [{ id: 5, name: 'Artizon ç¾è¡“é¤¨', type: 'spot', note: 'è«å…§å±•' }, { id: 6, name: 'å°ç¶²ç¥ç¤¾', type: 'spot', note: 'å¼·é‹å„é™¤' }] },
                    { date: '3/08', hotel: 'æ¸…æ¾„ç™½æ²³ Comfort Hotel', hotelAddr: 'æ±äº¬éƒ½æ±Ÿæ±å€ç™½æ²³1-6-12', spots: [{ id: 7, name: 'æ±äº¬å·¨è›‹', type: 'spot', note: 'WBC å°éŸ“ 12:00' }] },
                    { date: '3/09', hotel: 'JRæ±æ—¥æœ¬é…’åº— Mets æ©«æ¿±', hotelAddr: 'ç¥å¥ˆå·ç¸£æ©«æ¿±å¸‚ç¥å¥ˆå·å€é¶´å±‹ç”º1-1-1', spots: [{ id: 8, name: 'æ©«æ¿±ç´…ç£šå€‰åº«', type: 'shop', note: 'é€›è¡—' }] },
                    { date: '3/10', hotel: 'JRæ±æ—¥æœ¬é…’åº— Mets æ©«æ¿±', hotelAddr: '', spots: [{ id: 9, name: 'éŒå€‰å¤§ä½›', type: 'spot', note: 'é•·è°·ç«™' }] },
                    { date: '3/11', hotel: 'Home', hotelAddr: '', spots: [{ id: 10, name: 'ç¾½ç”°æ©Ÿå ´', type: 'spot', note: 'è¿”å®¶' }] }
                ];
                // é å¡«æ©Ÿç¥¨èŠ±è²»
                this.budget.expenses = [{ item: 'ANA æ©Ÿç¥¨', amount: 25186, date: '2026/03/05' }];
            }
        }
    },
    created() {
        this.init();
        fetch('https://api.exchangerate-api.com/v4/latest/JPY').then(r => r.json()).then(d => this.exchangeRate = d.rates.TWD.toFixed(4)).catch(()=>{});
    }
}).mount('#app');
</script>
</body>
</html>
